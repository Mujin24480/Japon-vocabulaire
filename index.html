<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vocabulaire Japonais — Entraînement</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg1: #f7f7fb; --bg2: #f0f7ff;
      --torii: #e1144d; --torii-dark: #be123c;
      --accent: #6d28d9; --accent-dark: #5b21b6;
      --paper: #fffdf7;
      --ink: #0f172a; --muted: #64748b;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%;
      font-family: 'Poppins', sans-serif;
      color: var(--ink);
      background: radial-gradient(circle at top right, #bdeafe 0, transparent 55%), linear-gradient(180deg, var(--bg2), var(--bg1));
      display: flex; justify-content: center; align-items: flex-start;
      padding: 20px;
    }
    h1 {
      font-size: 2.5rem; font-weight: 800; color: var(--ink);
      text-align: center; margin-bottom: 0.25em;
    }
    h1 span { color: var(--torii-dark); }
    p { text-align: center; color: var(--muted); margin-bottom: 1em; }
    button {
      font-family: inherit; cursor: pointer; border: none;
      border-radius: 16px; padding: 12px 28px; font-weight: 600; font-size: 1rem;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .red { background: var(--torii); color: white; }
    .purple { background: var(--accent); color: white; }
    .add { background: white; color: var(--torii-dark); border: 2px solid var(--torii-dark); margin-top: 12px; }
    .container {
      background: var(--paper);
      border-radius: 20px; padding: 30px; width: 90%; max-width: 800px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.05);
      text-align: center; position: relative;
    }
    .level-group { display: flex; gap: 10px; justify-content: center; margin-bottom: 12px; }
    table {
      border-collapse: collapse; width: 100%; margin-top: 15px;
    }
    th, td {
      border: 1px solid #ddd; padding: 8px; text-align: center;
    }
    input[type="text"] {
      width: 90%; padding: 6px; border: 1px solid #ccc; border-radius: 8px;
      font-family: inherit;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><span>Vocabulaire Japonais</span> — Niveaux</h1>
    <p>Crée plusieurs listes de vocabulaire puis entraîne-toi avec les niveaux correspondants.</p>

    <div id="levelContainer"></div>

    <button class="add" onclick="ajouterNiveau()">+ Ajouter un niveau</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // === Configuration Firebase ===
    const firebaseConfig = {
      apiKey: "AIzaSyCUDBRe1uTw1o_me-JaYvzhDGP62m4fQz4",
      authDomain: "japon-2026.firebaseapp.com",
      databaseURL: "https://japon-2026-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "japon-2026",
      storageBucket: "japon-2026.firebasestorage.app",
      messagingSenderId: "838871791341",
      appId: "1:838871791341:web:758bb567d9018146543ee4",
      measurementId: "G-9490H8V2X4"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // === Interface ===
    let niveauCount = 1;
    const levelContainer = document.getElementById('levelContainer');

    function renderNiveaux() {
      levelContainer.innerHTML = '';
      for (let i = 1; i <= niveauCount; i++) {
        const div = document.createElement('div');
        div.className = 'level-group';
        div.innerHTML = `
          <button class="red" onclick="ouvrirNiveau(${i})">Niveau ${i}</button>
          <button class="purple" onclick="ouvrirListe(${i})">Liste ${i}</button>
        `;
        levelContainer.appendChild(div);
      }
    }

    function ajouterNiveau() {
      niveauCount++;
      renderNiveaux();
    }

    renderNiveaux();

    // === Liste (tableau) ===
    function ouvrirListe(n) {
      const win = window.open('', `_blank`);
      win.document.write(`
        <html><head><title>Liste ${n}</title></head>
        <body style="font-family: Poppins; text-align:center;">
        <h2>Liste ${n}</h2>
        <label>Nombre de lignes :
          <select id="rowCount">
            <option>10</option><option>20</option><option>30</option>
            <option>40</option><option>50</option>
          </select>
        </label>
        <button onclick="genererTableau()">OK</button>
        <div id="tableContainer"></div>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"><\/script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"><\/script>
        <script>
          const firebaseConfig = ${JSON.stringify(firebaseConfig)};
          const app = firebase.initializeApp(firebaseConfig);
          const db = firebase.database();
          const ref = db.ref('listes/liste${n}');
          let data = [];

          ref.on('value', snap => {
            data = snap.val() || [];
            genererTableau();
          });

          function genererTableau(){
            const nb = parseInt(document.getElementById('rowCount').value);
            let html = '<table><tr><th>Français</th><th>Japonais</th></tr>';
            for(let i=0;i<nb;i++){
              const f = data[i]?.fr || '';
              const j = data[i]?.jp || '';
              html += '<tr><td><input type="text" value="'+f+'" onchange="save('+i+', this.value, 0)"></td>'+
                      '<td><input type="text" value="'+j+'" onchange="save('+i+', this.value, 1)"></td></tr>';
            }
            html += '</table>';
            document.getElementById('tableContainer').innerHTML = html;
          }

          function save(i, val, col){
            if(!data[i]) data[i] = {fr:'', jp:''};
            if(col==0) data[i].fr = val; else data[i].jp = val;
            ref.set(data);
          }
        <\/script>
        </body></html>
      `);
    }

    // === Niveau (test) ===
    function ouvrirNiveau(n) {
      const win = window.open('', `_blank`);
      win.document.write(`
        <html><head><title>Niveau ${n}</title></head>
        <body style="font-family:Poppins;text-align:center;">
        <h2>Niveau ${n}</h2>
        <button onclick="go()">GO</button>
        <input id="answer" placeholder="Écris ici..." style="margin:10px;padding:8px;border-radius:8px;">
        <button onclick="verif()">Vérifier</button>
        <div id="result"></div>

        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"><\/script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"><\/script>
        <script>
          const firebaseConfig = ${JSON.stringify(firebaseConfig)};
          const app = firebase.initializeApp(firebaseConfig);
          const db = firebase.database();
          const ref = db.ref('listes/liste${n}');
          let mots = [];
          let motActuel = null;

          ref.on('value', snap => { mots = snap.val() || []; });

          function go(){
            if(mots.length===0) return alert('Aucun mot disponible !');
            motActuel = mots[Math.floor(Math.random()*mots.length)];
            document.getElementById('result').innerHTML = '<h3>'+motActuel.fr+'</h3>';
          }

          function verif(){
            const rep = document.getElementById('answer').value.trim();
            const corr = motActuel?.jp || '';
            const res = document.getElementById('result');
            if(rep === corr) res.innerHTML = '<p style="color:green;">✅ Correct ! ('+corr+')</p>';
            else res.innerHTML = '<p style="color:red;">❌ Faux. Réponse : '+corr+'</p>';
          }
        <\/script>
        </body></html>
      `);
    }
  </script>
</body>
</html>
